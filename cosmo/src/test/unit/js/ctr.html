<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--
For use with the JsUnit from www.jsunit.net
-->
<head>
  <title>Cosmo Tests</title>

  <!-- JsUnit -->
  <link rel="stylesheet" type="text/css" href="jsunit/css/jsUnitStyle.css">
  <!-- hack so we can get somewhere loading this file standalone without error -->
  <script language="JavaScript" type="text/javascript">
      var xbDEBUG = ''; xbDEBUG.on = false;
      var djConfig = {isDebug: true, debugContainerId:"output"};
  </script>
  <script src="jsunit/app/jsUnitCore.js" language="JavaScript" type="text/javascript"></script>

  <!-- scripts under test -->
  <script src="../../../main/webapp/js/lib/dojo/dojo.js" language="JavaScript" type="text/javascript"></script>
  <script src="../../../main/webapp/js/cosmo/util/debug.js" language="JavaScript" type="text/javascript"></script>

  <!-- dojo setup stuff -->
  <script language="JavaScript" type="text/javascript">

      dojo.require("dojo.widget.*");
      dojo.registerNamespaceManifest("cosmo", "../../cosmo", "cosmo", "cosmo.ui.widget",null);      
      dojo.registerModulePath("cosmotest", "../../../../../test/unit/js/cosmo")
      dojo.require("cosmo.env");
      dojo.require("cosmotest.testutils");
      cosmo.env.setBaseUrl("../../../main/webapp/");

  </script>

  <!-- jsunit api wrapper -->
  <script src="testtools/JsTestManager/jsunit_wrap.js" language="JavaScript" type="text/javascript"></script>


  <!-- end of jusnit wrapper -->
<!--
  <script src="$JSUNIT_POST" language="JavaScript" type="text/javascript"></script>
-->

  <!-- doing this in body onload seems to disable jsunit -->
  <script language="JavaScript" type="text/javascript">
    var bu_alert = dojo.hostenv.println;
    print = dojo.hostenv.println;
    cosmotest.testutils.init(
        ["cosmotest.model.test_model",
        "cosmotest.model.test_eventStamp",
        "cosmotest.model.util.test_util",
        "cosmotest.datetime.test_7581",
        "cosmotest.datetime.test_date",
        "cosmotest.datetime.test_timezone",
        "cosmotest.service.translators.test_eim"
        ]
     );
  </script>
</head>
<!--<body onload="alert('hieatt_core.html onload, number scripts=' + document.getElementsByTagName('script').length); jum.init()">-->
<!--<body onload="jum.init()">-->
<body>
  <table id="test-menu">
  </table>
<script type="text/javascript" language="JavaScript">
   var test_names = jum.alltests_.group_names_;
   var test_menu = document.getElementById("test-menu");
   for (var i in test_names) {
     var row = document.createElement("tr");
     var col = document.createElement("td");
     var box = document.createElement("input");
     box.setAttribute("type","checkbox");
     box.setAttribute('value',test_names[i]);
     col.appendChild(box);
     row.appendChild(col);
     test_menu.appendChild(row);
     col = document.createElement("td");
     col.appendChild(document.createTextNode(test_names[i]));
     row.appendChild(col);
   }
   
   function checkBoxesFromLocation(){
   	   var testNames = location.search.slice(1).split("&");
       var tests = {};
       
       for (var i = 0; i < testNames.length; i++){
           var testQuery = testNames[i].split("=");
           if (testQuery[0] == "t"){
               tests[testQuery[1]] = true;
           }
       }
       var inputs = test_menu.getElementsByTagName("input");
       for (var i = 0; i < inputs.length; i++){
           if (tests[inputs[i].value]){
               inputs[i].checked = true;
           }
       }
   }
   
   checkBoxesFromLocation();
   
   function getCurrentQueryString(){
       var inputs = test_menu.getElementsByTagName("input");
       var qs = "?";
       var qsElements = 0;
       for (var i = 0; i < inputs.length; i++){
           if (inputs[i].checked) {
           	   var and = (qsElements > 0)? "&" : "";
               qs = qs + and + "t=" + inputs[i].value;
               qsElements++;
           }
       }
	   return qs;
   }
   
   
   function run_tests() {
       var tests = []
       for (var i in test_menu.childNodes) {
           var test_row = test_menu.childNodes[i];
           if (test_row.nodeType != Node.ELEMENT_NODE) continue;

           if (test_row.childNodes[0].childNodes[0].checked) {
             jum.runGroup(test_row.childNodes[1].childNodes[0].data);
           }
       }
   }
   
   function checkAll(){
       var inputs = test_menu.getElementsByTagName("input");
       for (var i = 0; i < inputs.length; i++){
           inputs[i].checked = true;
       }
   }
   
   function uncheckAll(){
       var inputs = test_menu.getElementsByTagName("input");
       for (var i = 0; i < inputs.length; i++){
           inputs[i].checked = false;
       }
   }
   
   function clearOutput(){
       var out = document.getElementById(djConfig.debugContainerId);
       out.innerHTML = "";
   }
   
   /*
   Convenience!
   */
   document.onkeyup = function (e){
	   if (String.fromCharCode(e.keyCode) == 'R'){
 		   location = location.href.split("?")[0] + getCurrentQueryString();
 	   }

	   if (String.fromCharCode(e.keyCode) == 'T'){
 		   run_tests();
 	   }

	   if (String.fromCharCode(e.keyCode) == 'U'){
			uncheckAll();
 	   }

	   if (String.fromCharCode(e.keyCode) == 'A'){
			checkAll();
 	   }

	   if (String.fromCharCode(e.keyCode) == 'C'){
           clearOutput();
 	   }
   }
</script>
   <button id="run_tests" onclick="run_tests()">Run Tests</button>
  <br />
  <br />
  <div id="output">
  
  </div>
</body>
</html>
