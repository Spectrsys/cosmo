<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>OSAF - Spec Title</title>
  <link href="Spec.css" type="text/css" rel="stylesheet" />
  <meta http-equiv="Content-type"
 content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta name="description" content="OSAF Project Specification" />
  <meta name="keywords" content="OSAF, Open Source, Specification" />
</head>
<body>
<div id="masthead">
<div id="breadcrumbs"><a
 href="http://wiki.osafoundation.org/bin/view/Cosmo/CosmoHome">Cosmo
Home</a> &gt; <a
 href="http://wiki.osafoundation.org/bin/view/Cosmo/ZeroPointTwoHome">Cosmo
0.2</a>
&gt; Cosmo 0.2 Specification<br />
</div>
<h1>Cosmo 0.2 Specification<br />
</h1>
<table width="100%">
  <tbody>
    <tr>
      <td width="33%">Authors:
      <a href="mailto:bcm@osafoundation.org">Brian
Moseley</a></td>
      <td width="33%">Last
edited: May 19, 2005 </td>
      <td width="33%">Creation
date: May 3, 2005</td>
    </tr>
    <tr>
      <td colspan="3">Reviewers:
        <a href="mailto:lisa@osafoundation.org">Lisa Dusseault</a>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div class="issue issue issue even issue issue code issue"
 id="maincontent">
<h2>Overview</h2>
<h3>Goals and Objectives</h3>
<p>Cosmo 0.2 has four primary
goals:</p>
<ol>
  <li>Support for Chandler 0.6 sharing features</li>
  <li>An interface for end users to sign up for and manage their own accounts</li>
  <li>Basic standards-based interoperability with calendar clients other than Chandler</li>
  <li>Windows platform support</li>
  <li>Special support for Apple iCal so that their calendar sharing format (which is
    iCalendar, but not CalDAV) can be translated from (and possibly to) the format
    used by CalDAV/Chandler.</li>
</ol>
<dl>
  <dt>Brian Moseley</dt>
  <dd>Spec owner, development lead<span style="font-weight: bold;"> </span></dd>
</dl>
  
<h3>Background</h3>

  <p>The initial version of Cosmo
focused on securely providing basic sharing support for multiple users
in a single repository. Sharing in Cosmo 0.1 is performed solely by
WebDAV; there are no calendar-specific features. A user can 
synchronize a collection across multiple instances of Chandler by
storing opaque data files in the user's Cosmo home directory. However,
Cosmo 0.1 does not provide a mechanism for allowing a second user to
  view or edit the collection.</p>
  
<p>In Cosmo 0.1, an administrator
has to log into the "admin console" web user interface to provision an
account for an end user and then email or otherwise communicate the
account details to the user. This is a significant barrier to usage of
Chandler's sharing and synchronization features, especially considering
that OSAF (and perhaps other organizations) will in the future host a
public Cosmo server for users who are not part of a workgroup with a
dedicated Cosmo installation and administrator.</p>
  
<p>One of the primary goals for
the eventual Cosmo 1.0 is interoperability with standards-based
calendar clients via CalDAV. A staged approach toward CalDAV
implementation allows the realization of primary interoperability use
cases in early Cosmo and Chandler versions. Furthermore, Cosmo should
make special allowance for Apple's iCal, which uses the "first generation"
technique
of publishing and subscribing to monolithic iCalendar resources
(events, timezones, and calendar bundled into a single WebDAV resource)
rather than the single-iCalendar-object-per-resource approach of CalDAV.</p>
  
<h3>Use Cases</h3>
<ul>
  <li>A Chandler user attempts to
share his calendar for the first
time. Lacking a WebDAV account, he is given a link to a Cosmo web page
where he can sign up for an account.</li>
  <li>A user is entering WebDAV
information for an existing Cosmo
account into a Chandler installation on a second computer, but he has
forgotten his username.</li>
  <li>A user is entering WebDAV
information for an existing Cosmo
account into a Chandler installation on a second computer, but he has
forgotten his password.</li>
  <li>A user changes his username,
email address, and/or password via a
Cosmo web page.</li>
  <li>A Chandler user shares a
calendar with a set of friends who also
use Chandler. Some of the friends are allowed to update the calendar,
while the others can only view the calendar.</li>
  <li>A Chandler user shares a
calendar with a friend who subscribes to
it with iCal.</li>
  <li>A Chandler user subscribes
to a calendar published by a friend
who uses iCal.</li>
</ul>

  <h2>Requirements</h2>

  <h3>Tickets (Access control)</h3>

  <p>Cosmo must accept a ticket
specified in the URL of a WebDAV resource
in preference to other authentication schemes and access control
procedures (e.g. Basic authentication, ACL-based authorization) as
per <em>Ticket-Based Access Control Extension
to WebDAV</em> (see link at bottom).  In addition, must be able to accept
  ticket-creation requests, though only for unlimited-life and unlimited-use
  tickets.  Cosmo 0.2 should reject requests for tickets with limited life or 
  limited use.</p>
  
  
  <p>Cosmo 0.2 will not support any
mechanisms for controlling access to
a user's home directory by another user other than tickets. A future
version will allow
a user to assign permissions on his home directory to other users
(probably only on the same server) via WebDAV ACL and a web user
interface.</p>

  

  <h3>iCalendar (RFC2445) and CalDAV Interoperability</h3>

  <p>Cosmo must be able to store iCalendar calendar and event objects in
its repository in such a way as to facilitate CalDAV queries, even
though those queries are not supported by this version of Cosmo.
Addressing this requirement eliminates a significant risk early in
Cosmo's development (that of not knowing how much effort it will take
to make the repository aware of calendar content) and reduces the
  amount of data migration necessary when upgrading to future versions.</p>
  
  <p>Cosmo 0.2 must validate new or updated event resources for correct
  syntax and semantics on each PUT request.  GET and DELETE will be handled
  normally for event resources.</p>
  
  <p>Cosmo will support CalDAV's MKCALENDAR request.  Cosmo will advertise
    support for CalDAV even though not all of CalDAV will be interoperable
  in 0.2.</p>
  
  <p>Cosmo 0.2 will support PROPFIND on calendar collections, listing 
    individual event resources, but not the special CalDAV REPORTs.
  
  <h3>Apple's iCal Interoperability</h3>
  
  <p>Basic client/server interoperability with Apple's iCal client 
    will be supported for Cosmo 0.2.  Apple's iCal works with calendar
    data at a granularity of one file per calendar and expects to be able to 
    GET, PUT and DELETE whole-calendar iCalendar resources (iCal does not
    understand CalDAV collections or single-event resources). Cosmo will translate
  to and from this format for both read and write operations as follows.</p>
  

  <ul>
    <li>iCal expects to be able to use a single resource with a URL ending in .ics
      and a certain MIME type (text/calendar).  Cosmo will handle these URLs, 
      managing a dynamic resource that will appear alongside a CalDAV calendar
      collection URL, in the same parent collection.
    </li>
    <li>A GET request to the URL used by iCAL will be handled by the Cosmo 
    server bundling the calendar data into a single .ics file for the response.</li>
    <li>A DELETE request will remove the calendar collection as well as the 
    monolithic calendar resource.</li>
    <li>A PUT request will be interpreted and individual event resources in
      the calendar collection will be
      added, overwritten or deleted as appropriate (not overwritten wholesale).
    More on this in protocol interactions section.</li>
    </ul>
    
  
  <!-- Do we say something about Cosmo's "native" format? -->
    

  <h3>Chandler share data</h3>

  <p>Cosmo must allow Chandler to
store arbitrary data files within a calendar collection. When sharing
an ItemCollection, Chandler will create a calendar collection in the
user's home directory to contain iCalendar resources and beneath that a
regular collection to contain the shared ContentItems in Chandler's
internal format. Cosmo does not have to understand the names or formats
of any of the resources within the subcollection. The subcollection
itself does not have to follow any particular naming policy; because
CalDAV specifies that calendar collections may not contain other
calendar collections, Cosmo can ignore any subcollections of a calendar
collection when generating an iCalendar view of a calendar collection.</p>

  <h3>Assumptions</h3>

  <ul>
  <li>The CalDAV server timezone collection functionality is being removed
  from CalDAV in draft version 06 therefore Cosmo will not support it.</li>

    <li>Tickets do not necessarily represent unique individuals; a ticket
    can be given to and used by multiple persons.</li>
    
  <li>Tickets will not be used in the timeframe of Cosmo 0.2 to access 
  the web user interface.</li>
    
    <li>We are making certain assumptions about Apple's iCal client functionality
      that will need to be confirmed through interoperability testing or other
      testing. If our assumptions turn out to be incorrect we'll update the design decisions
    described here.</li>

    <li>Chandler 0.6 schedule currently includes work for Chandler to support 
      the iCalendar format for event resources and to use it to create resources.
      This work is required in order to interoperate with Apple iCal and with
    Cosmo's support for iCal.  Morgen confirmed that this is on his 0.6 schedule.</li>
    
  </ul>

  <h3>High-level Decisions</h3>
  
  <p>Chandler 0.6 will provide a
link to a Cosmo account signup page
whenever a user is prompted to enter WebDAV account information. A
future version will support a Cosmo API for automated account creation.</p>

  <h3>Terminology</h3>
<dl>
  <dt>Calendar collection</dt>
  <dd>A WebDAV collection that
advertises to clients that it may
contain calendar resources; may contain non-calendar resources and
collections but may not contain calendar collections.</dd>
  <dt>ContentItem</dt>
  <dd>A piece of information
stored by Chandler such as a calendar,
event, or email message; not shareable itself, only as part of an
ItemCollection</dd>
  <dt>Individual iCalendar resource</dt>
  <dd>An HTTP resource containing
an iCalendar representation of a
single calendar object (calendar, event, or timezone)</dd>
  <dt>ItemCollection</dt>
  <dd>A group of Chandler
ContentItems that can be shared between
Chandler users; the fundamental unit of sharing for Chandler</dd>
  <dt>Monolithic iCalendar resource</dt>
  <dd>An HTTP resource containing
an iCalendar representation of a
calendar and its constituent events and timezones</dd>
  <dt>WebDAV collection</dt>
  <dd>A resource on a WebDAV
server that can contain other resources;
roughly equivalent to a directory or folder in a file system</dd>
</dl>
  
<h2>User Interface / Interaction</h2>
<h3>Account Signup</h3>
<p>This page has a form with these
fields:</p>
<ul>
  <li>username (required, must be
unique, 3-32 chars long, legal chars
are letters, numbers, underscores, spaces, periods, hyphens,
apostrophes)</li>
  <li>email address (required, must be unique,
1-32 chars long)</li>
  <li>password (required, 5-16
chars long)</li>
  <li>password confirmation
  (required, must match password)</li>
  <li>Full name (required, 1-100 chars long)</li>
</ul>
  
<p>The user registration form captures full name so that later on we can
use this information in places like access logs, interfaces to browse peoples' 
calendars, etc.  If we don't capture full name now then there will be accounts
created on test and trial servers which don't have this information.  Asking
for full name is appropriate for the dogfood usage expected in 0.2 timeframe 
although later in hosting situations we might find some resistance from users 
who don't want to reveal full names.</p>
  
  <p>The email address is required to be unique so that we can look up accounts
    even when login IDs are forgotten.  It is easier to change our minds later 
    and relax this requirement than it is to go the other way.</p>
  
<p>When the form is submitted, the
server validates the input.</p>

  <ul>
  <li>If validation fails, the
form is redisplayed including a message
for each error</li>
  <li>Otherwise the server creates
the account, sends a confirmation
email to the specified address, logs in the user and displays the
Welcome Page.</li>
  </ul>
  

  <h3>Account Management</h3>

  <p>This page has a form with the
same fields as on the Account Signup
page. The validation rules are slightly different in that the password
and confirmation are not required if the password is not being changed
(but both are required if the password is being changed).</p>

  <p>When the form is submitted, the
server validates the input.</p>

  <ul>
  <li>If validation fails, the
form is redisplayed including a message
for each error.</li>
  <li>Otherwise the server updates
the account and redisplays the
Account Management Page.</li>

  </ul>

  <h3>Forgotten Username or password</h3>

  <p>This <em>popup</em> has a form containing
  a single email address field.</p>
  
  <p>When the form is submitted, the
server validates the given address.</p>

  <ul>
  <li>If an account does not exist
with the address, the form is
redisplayed including an error message.</li>
  <li>Otherwise, the server sends
an email to the address containing
the username of the associated account and redisplays the Login Page.</li>

  </ul>


  <h3>Forgotten Password</h3>

  <p>This <em>popup</em> has a form containing
a single username field.</p>
<p>When the form is submitted, the
server validates the given username.</p>
<ul>
  <li>If an account does not exist
with the username, the form is
redisplayed including an error message.</li>
  <li>Otherwise, the server sends
an email containing the password of the associated account to the
account's address and redisplays the Login Page.</li>
</ul>
  
<h2>Protocol Interactions</h2>

  <h3>Tickets</h3>

  <p>Cosmo will implement the MKTICKET
and DELTICKET methods defined in <em>Ticket-Based Access Control Extension
to WebDAV</em> (see link at bottom). Ticket discovery is not required,
since Chandler will remember any generated tickets. Chandler-generated
tickets will never have timeouts or use limits.</p>

    <p> If MKTICKET is used to attempt to create a ticket with timeouts or
    use limits, Cosmo should reject that request (501 Not Supported)</p>
    
      

    <h3>CalDAV</h3>

  <p>Cosmo will implement
individually-addressable calendar objects and the MKCALENDAR method as
per <em>Calendaring Extensions to WebDAV (CalDAV)</em> (see
  link at bottom).</p>
  
    <h3>iCal's usage</h3>
      
    <p>Although iCal uses normal HTTP and WebDAV requests (PUT, GET in 
      particular), its data model is inconsistent with that of CalDAV and
      that used by Chandler.  Thus, Cosmo will require special handling of
    certain requests from iCal.</p>
    
    <p>Handling iCal GET requests is expected to be rather straightforward.
      Cosmo will take all the event resources in the calendar collection
      (the one with the same base name as the URL used by iCal) and wrap those
      events up into one iCalendar file with START:VCALENDAR and END:VCALENDAR
      around it.  For 0.2, where performance isn't likely to be a problem,
      Cosmo can concatenate event data either in memory or while streaming 
    over the wire.  </p>
    
    <p>Handling iCal PUT requests requires a little more care.</p>
    
    <ul>
      <li>Parse the entire iCalendar file and reject the PUT request
      if it can't be parsed.</li>
      <li>Compare the list of events from iCal to the list of events in
        the calendar collection.  If the calendar collection doesn't yet
        exist, create it and all the event resources inside it.  If it
        does already exist, figure out which events are new in the iCal
      data and which resources are absent in the iCal data (deleted).</li>
      <li>For each event that is new in the iCal data, create a new
        event resource in the calendar collection, preserving all the data 
        provided.</li>
      <li>For each event that is absent in the iCal data, delete the 
      event resource in the calendar collection.</li>
      <li>For events that appear in both the iCal data and the existing 
        calendar collection, determine if the event data is identical or
        has been changed.  See note.</li>
      <li>For events that have not been changed, leave the event resource
        untouched so that the ETag doesn't change and Chandler synchronization
      works better.</li>
      <li>For events that have changed, update the event resource.</li>
    </ul>
    
    <p>Note: One concern with this plan is what to do if Apple iCal alters
      event data routinely.  For example, Chandler wishes to preserve timezone
      information for each event but it's conceivable that iCal might translate
      all events to UTC and lose that information.  If we run into any of these
    kinds of issues we may or may not be able to deal with it easily.</p>
    
    

  <h2>Special Considerations</h2>

  <h3>QA / Test</h3>
<p>Cosmo will provide a full suite
of unit and integration tests for
every subsystem so that QA can focus on functional and security
testing. This should involve verifying the behaviors described in the
"User Interface/Interaction" section above and attempting to compromise
the system (see "Security" below).</p>
<p>As we do not have any explicit
performance or scalability goals at
this time, tests in those areas should probably be limited to
establishing a baseline which can be used to compare the qualities of
successive versions.</p>
<h3>API / Developer Platform</h3>
<p>Cosmo 0.2 will not support any
external APIs.<br />
</p>
<h3>Security</h3>
<p>Historically many web sites and
applications have been susceptible
to URL hacking, SQL injection, cross site scripting, and similar
attacks. A professional web application in 2005 has no excuse for these
sorts of vulnerabilities.</p>
<p>Other security concerns include
verifying that a generated ticket
has exactly the requested set of permissions (read or read/write) on
the associated resource only (the ticket should not allow access to any
other resource) and assuring that the tickets cannot be forged or
spoofed.</p>
<p>Unfortunately the ticket scheme
is inherently insecure, even more so
due to Chandler 0.6's policy of using non-expiring, infinite-use
tickets. This means that a ticket-bearing URL placed on a web page
could be indexed by Google, for instance, making the ticketed resource
available to the world at large. The only way to guarantee the security
of a ticket in a sharing notification is by exchanging the URL in a
fully encrypted fashion (via S/MIME, for example) and not exposing it
to unauthorized or untrusted clients.</p>
<p>Furthermore, Chandler 0.5 does
not support WebDAV over SSL, so
tickets are exposed as soon as they are generated by the server and
sent to the client.  Chandler 0.6, however, will support WebDAV over
SSL.</p>

<p>Cosmo 0.2 will only support
Basic authentication and ticket access control. A
future version will add Digest support in preference to Basic.</p>


    <h3>Internationalization / Localization</h3>

    <p>JSTL and Java message resource
bundles will be used to provide an
internationalized web user interface. The web interface will be
designed to be as locale-independent as possible (avoiding intermixing
widgets and text, using coarse-grained message resources, etc). The
only shipped localization will be US English, but we will obviously
accept localizations in this area.</p>
<p>Exceptions and other messages
written to the Cosmo logs will be in
US English. There are no plans to provide localized log messages in
future versions of Cosmo, although we are open to debate on this issue.</p>
<p>Questions of
internationalization of the data stored in the Cosmo
repository are deferred to a later version.</p>
<h3>Accessibility</h3>
<p>Not enough is known about web
user interface accessibility at this
time. It is anticipated that future versions of Cosmo will provide
keyboard shortcuts and utilize other XHTML accessibility mechanisms as
appropriate. Community discussions on this topic are welcomed.</p>
<h3>Build / Install</h3>
<p>Cosmo's build system will be
migrated from Ant to Maven, and the source code will be moved from CVS
to Subversion.</p>
</div>
<div id="codicille">
<h2>Useful Links</h2>
<ul>
  <li><a
 href="http://www.sharemation.com/%7Emilele/public/dav/draft-ito-dav-ticket-00.txt">Ticket
spec</a></li>
  <li><a href="http://ietf.webdav.org/caldav/draft-dusseault-caldav.txt">CalDAV
spec</a></li>
  <li><a href="http://www.faqs.org/rfcs/rfc2445.html">RFC 2445
(iCalendar)</a></li>
  <li><a
 href="http://cvs.osafoundation.org/viewcvs.cgi/*checkout*/docs/specs/rel0_6/Sharing-0.6.html?rev=HEAD">Chandler
0.6 Sharing spec</a></li>
</ul>
<h2>History</h2>
<table width="100%">
  <tbody>
    <tr>
      <th width="15%">Author</th>
      <th width="15%">Edit
date</th>
      <th width="70%">Description</th>
    </tr>
    <tr>
      <td><a href="mailto:bcm@osafoundation.org">bcm</a></td>
      <td>May 4, 2005</td>
      <td>First Draft</td>
    </tr>
    <tr>
      <td><a href="mailto:bcm@osafoundation.org">bcm</a></td>
      <td>May 9, 2005</td>
      <td>added Windows support as
a goal, removed RDBMS-&gt;JCR migration from build/install section,
added Ant-&gt;Maven and CVS-&gt;Subversion migrations to
build/install sections, made Chandler 0.6 WebDAV/SSL support an issue,
removed Login and Welcome pages from User Interface section (they
already exist in 0.1), added iCalendar awareness requirement, removed
Code Design section (will address separately later)</td>
    </tr>
    <tr>
      <td><a href="mailt:lisa@osafoundation.org">Lisa D</a></td>
      <td>May 19, 2005</td>
      <td>Added more detail about supporting Apple iCal.  Cleaned up
        issues, making strawman decisions about things like email 
      uniqueness.</td>
    </tr>
    
  </tbody>
</table>
</div>
</body>
</html>
